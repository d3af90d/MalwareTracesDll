# MalwareTracesDll

Library used to intercept and log network requests made by a particular process by intercepting network-related Windows API calls.

The information gets written in some CSV files in the `C:\malwareTraces\packet_info\` folder.

# Usage
1. Place the DLL in `C:\malwareTraces\`
2. Load the DLL on the target executable with [this](https://github.com/d3af90d/MalwareTracesInjector) program.

# Requirements

Create the required folders:
```powershell
New-Item -Path 'C:\malwareTraces\packet_info' -ItemType Directory
```

The machine MUST have the folder `C:\malwareTraces\`

The folder `C:\malwareTraces\` must contain:
- `C:\malwareTraces\MalwareTracesDll` The result of compiling this repository
- `C:\malwareTraces\packet_info\` The DLL logs directory

If you want to automatically copy the DLL to `C:\malwareTraces\MalwareTracesDll` everytime you compile it in Visual Studio:
- Go to _Solution Explorer Properties_
- _Build Events_ -> _Post-Build Event_
- Add `xcopy /y /d "$(TargetPath)" "C:\malwareTraces\"` to _Command Line_ -> _Apply_

![Solution Explorer Properties](https://github.com/d3af90d/MalwareTracesDll/blob/master/readme_assets/post-build-00.png)
![Post-Build Event](https://github.com/d3af90d/MalwareTracesDll/blob/master/readme_assets/post-build-01.png)

## Structure

In the source code there are four main files:

- [`dllmain.cpp`](https://github.com/d3af90d/MalwareTracesDll/blob/master/dllmain.cpp)

Contains the Main() DLL function. Here function hooks get ATTACHED/DETACHED and there is some variable initialization

- [`Hooks.h`](https://github.com/d3af90d/MalwareTracesDll/blob/master/Hooks.h)

Header containing the implementation of the custom hook functions

- [`Utils.h`](https://github.com/d3af90d/MalwareTracesDll/blob/master/Utils.h)

Header for utility functions, data structures and global variables

- [`TypeDefinitions.h`](https://github.com/d3af90d/MalwareTracesDll/blob/master/TypeDefinitions.h)

Header that contains the function pointers definitions for the real Windows API functions
